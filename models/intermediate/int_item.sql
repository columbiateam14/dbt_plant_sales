SELECT 
    ii.ITEM_NAME,
    ii.PRICE_PER_UNIT,
    COALESCE(SUM(ii.ADD_TO_CART_QUANTITY), 0) AS TOTAL_ADDED_TO_CART,
    COALESCE(SUM(ii.REMOVE_FROM_CART_QUANTITY), 0) AS TOTAL_REMOVED_FROM_CART,
    COALESCE(SUM(os.CART_QUANTITY), 0) AS TOTAL_QUANTITY_ORDERED,
    COALESCE(SUM(CASE WHEN os.IS_REFUNDED = 'yes' THEN 0 ELSE os.PRICE_PER_QUANTITY END), 0) AS TOTAL_PLANT_PROFIT,
FROM {{ ref('base_snowflake__item_views') }} AS ii
LEFT JOIN {{ ref('int_order_summary') }} AS os 
    ON ii.ITEM_NAME = os.ITEM_NAME
GROUP BY ii.ITEM_NAME, ii.PRICE_PER_UNIT
ORDER BY ITEM_NAME